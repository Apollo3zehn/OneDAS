@inherits StateComponentBase

<EditForm class="h-100 flex-column" Model="@this.CodeDefinition" OnValidSubmit="@HandleValidSubmit">
    <DataAnnotationsValidator />

    <div>
        <MatSelectItem class="settings-control"
                       Label="Code Type"
                       Disabled="true"
                       @bind-Value="this.CodeDefinition.CodeType"
                       Items="this.AppState.CodeTypeValues">
            <ItemTemplate Context="value">
                @Utilities.GetEnumLocalization(@value)
            </ItemTemplate>
        </MatSelectItem>

        <MatSelectItem class="settings-control"
                       Label="Code Language"
                       @bind-Value="this.CodeDefinition.CodeLanguage"
                       Items="this.AppState.CodeLanguageValues">
            <ItemTemplate Context="value">
                @Utilities.GetEnumLocalization(@value)
            </ItemTemplate>
        </MatSelectItem>

        <MatCheckbox Class="settings-control"
                     Label="Publish"
                     @bind-Value="this.CodeDefinition.IsPublic">
        </MatCheckbox>

        <MatTextField class="settings-control"
                      Label="Name"
                      @bind-Value="this.CodeDefinition.Name">
        </MatTextField>

        @if (this.CodeDefinition.CodeType == CodeType.Filter)
        {          
            <MatSelectItem class="settings-control"
                           Label="Sample Rate"
                           @bind-Value="this.CodeDefinition.SampleRate"
                           Items="this.UserState.SampleRateValues">
            </MatSelectItem>
        }

        <div class="configuration-panel mt-auto">
            <div class="flex-row">
                <div class="configuration-panel-hover">
                    <div class="icon-button" @onclick="this.OpenCodeDefinitionProjectRequestDialog">
                        @this.CodeDefinition.RequestedProjectIds.Count
                        @if (this.CodeDefinition.RequestedProjectIds.Count == 1)
                        {
                            <MatSubtitle2 class="clear-margin">Project</MatSubtitle2>
                        }
                        else
                        {
                            <MatSubtitle2 class="clear-margin">Projects</MatSubtitle2>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <MatButton Class="w-100"
               Icon="@MatIconNames.Save"
               Outlined="true"
               Type="submit"
               Label="Save">
    </MatButton>

</EditForm>

<!-- Should be outside the form, otherwise there will come the following error:
 MatBlazor.MatCheckbox`1[System.Boolean] requires a value for the 'ValueExpression' parameter. Normally this is provided automatically when using 'bind-Value'. -->
<CodeDefinitionProjectRequestModal OnProjectIdsSelected="this.SelectProjectIds"
                                   @bind-IsOpen="this.CodeDefinitionProjectRequestDialogIsOpen"
                                   SelectedProjectIds="this.CodeDefinition.RequestedProjectIds" />
